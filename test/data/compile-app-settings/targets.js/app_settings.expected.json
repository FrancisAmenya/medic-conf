{
  "contact_summary": "",
  "tasks": {
    "rules": "define Target {_id: null,deleted: null,type: null,pass: null,date: null}define Contact {contact: null,reports: null}define Task {_id: null,deleted: null,doc: null,contact: null,icon: null,date: null,title: null,fields: null,resolved: null,priority: null,priorityLabel: null,reports: null,actions: null}rule GenerateEvents {when {c: Contact}then {var idx1,idx2,r,target,now=Utils.now(),targets=[{id:'active-pregnancies',appliesToType:'report',appliesIf:function(e,t){return'D'===t.form},date:'now'},{id:'imm-children-registered-this-month',appliesToType:'person',appliesIf:function(e){return e.age_in_months<=60},date:function(e){return e.contact.reported_date}}],tasks=[],place=['health_center','district_hospital','clinic'];for(idx1=0;idx1<targets.length;++idx1)if('contacts'===(target=targets[idx1]).appliesTo)c.contact&&'person'===c.contact.type&&-1!==target.appliesToType.indexOf('person')&&emitContactBasedTargetFor(c,target),c.contact&&-1!==place.indexOf(c.contact.type)&&-1!==target.appliesToType.indexOf(c.contact.type)&&emitContactBasedTargetFor(c,target);else if('reports'===target.appliesTo)for(idx2=0;idx2<c.reports.length;++idx2)r=c.reports[idx2],emitReportBasedTargetFor(c,r,target);if(tasks)for(idx1=0;idx1<tasks.length;++idx1){var task=tasks[idx1];if('reports'!==task.appliesTo&&'scheduled_tasks'!==task.appliesTo||!c.reports)c.contact&&'person'===c.contact.type&&'contacts'===task.appliesTo&&-1!==task.appliesToType.indexOf('person')?emitTasksForSchedule(c,tasks[idx1]):c.contact&&-1!==place.indexOf(c.contact.type)&&'contacts'===task.appliesTo&&-1!==task.appliesToType.indexOf(c.contact.type)&&emitTasksForSchedule(c,tasks[idx1]);else for(idx2=0;idx2<c.reports.length;++idx2)r=c.reports[idx2],emitTasksForSchedule(c,tasks[idx1],r)}function emitTasksForSchedule(r,c,n){var e;if((!c.appliesToForms||-1!==c.appliesToForms.indexOf(n.form))&&(!c.appliesIf||c.appliesIf(r,n)))if(n&&c.appliesIf){if(!n.scheduled_tasks)return;for(e=0;e<n.scheduled_tasks.length;e++)c.appliesIf(n,e)&&t(e)}else t();function t(e){var t,a,i,s,o=null;for(t=0;t<c.events.length;t++)a=c.events[t],n&&(o=a.dueDate?a.dueDate(n,a,e):void 0!==e?new Date(Utils.addDate(new Date(n.scheduled_tasks[e].due),a.days)):new Date(Utils.addDate(new Date(n.reported_date),a.days))),Utils.isTimely(o,a)&&(s={_id:n?n._id+'-'+a.id:r.contact._id+'-'+c.id,deleted:!(!(r.contact&&r.contact.deleted||n)||!n.deleted),doc:r,contact:r.contact,icon:c.icon,date:o,title:c.title,resolved:!!n&&c.resolvedIf(r,n,a,o,e),actions:n?c.actions.map(d):[]},void 0!==e&&(s._id+='-'+e),'function'==typeof(i=c.priority)&&(i=i(r,n)),i&&(s.priority=i.level,s.priorityLabel=i.label),emit('task',new Task(s)))}function d(e){return{type:'report',form:e.form,label:e.label||'Follow up',content:{source:'task',source_id:n._id,contact:r.contact}}}}function emitContactBasedTargetFor(e,t){if(!t.appliesIf||t.appliesIf(e)){var a=!t.passesIf||!!t.passesIf(e),i=createTargetInstance(t.id,e.contact,a);i.date=t.date?t.date(e):now.getTime(),emitTargetInstance(i)}}function emitReportBasedTargetFor(e,t,a){var i,s;if(!a.appliesIf||a.appliesIf(e,t))if(a.emitCustom)a.emitCustom(e,t);else switch(s=!a.passesIf||!!a.passesIf(e,t),(i=createTargetInstance(a.id,t,s))._id=('report'===a.idType?t._id:e.contact._id)+'-'+a.id,emitTargetInstance(i),a.date){case'now':i.date=now.getTime()}}function createTargetInstance(e,t,a){return new Target({_id:t._id+'-'+e,deleted:!!t.deleted,type:e,pass:a,date:t.reported_date})}function emitTargetInstance(e){emit('target',e)}emit('_complete',{_id:!0});}}",
    "schedules": {
      "test": true
    },
    "targets": {
      "enabled": true,
      "items": [
        {
          "id": "active-pregnancies",
          "type": "count",
          "icon": "pregnancy-1",
          "goal": -1,
          "translation_key": "targets.active_pregnancies.title",
          "subtitle_translation_key": "targets.all_time.subtitle"
        },
        {
          "id": "imm-children-registered-this-month",
          "type": "count",
          "icon": "child",
          "goal": -1,
          "translation_key": "targets.children_registered.title",
          "subtitle_translation_key": "targets.this_month.subtitle",
          "context": "user.parent.use_cases.split(' ').indexOf('imm') !== -1"
        }
      ]
    }
  }
}
